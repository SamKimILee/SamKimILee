<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{/thymeleaf/default_layout}">
<th:block layout:fragment="css">
	<link rel="stylesheet" href="/css/diary/diary-view.css">
</th:block>

<body>
<div class="main-content" layout:fragment="content">
	<!-- title -->
	<div class="title-section">
		<span class="memberid" th:text="${diary.memberId}">아이디</span>
		<img src="/img/journal/diary-sjournal.png" class="diary-journal" />
	</div>

	<div class="content-wrapper">

		<div class="content-section">
		<!-- 📌 캘린더 컨테이너 -->
			<div class="calendar-section">
            	<div id="calendar-container">
        			<!-- 드롭다운 컨트롤 -->
        			<div id="controls">
            			<select id="year-select"></select>
            			<select id="month-select">
                			<option value="0">January</option>
                			<option value="1">February</option>
                			<option value="2">March</option>
                			<option value="3">April</option>
                			<option value="4">May</option>
                			<option value="5">June</option>
                			<option value="6">July</option>
                			<option value="7">August</option>
                			<option value="8">September</option>
                			<option value="9">October</option>
                			<option value="10">November</option>
                			<option value="11">December</option>
            			</select>
        			</div>
			
					<!-- 캘린더 -->
        			<div id="calendar"></div>
    			</div>
			</div>
		</div>

		<div class="diary-button-section">
			<div class="diary-section">
				<!-- <img src="/img/journal/diary_read.png" class="diary_book" /> -->
				<!-- 일기 제목 & 날짜 -->
				<div class="diary-container">
					<div class="diary-header" id="diary-header">
						<p th:text="${diary.diaryTitle}"></p>
					</div>
					<div class="diary-date">
						<p class="diary-date">DATE:
							<span id="diary-date"
								  th:text="${diary.diaryDate != null ? diary.diaryDate.substring(0,10) : '날짜 없음'}"></span>
						</p>
					</div>

					<!-- 일기 내용 -->
					<div class="diary-content">
						<p th:utext="${diary.diaryContent}"></p>
						<!-- 첨부파일이 존재할 경우 -->
						<div class="attach-file" th:if="${attach != null}">
							<!-- 파일 확장자 확인 -->
							<div th:with="extension=${attach.getFileExtension()}">

								<!-- 이미지 파일인 경우 -->
								<div th:if="${extension == 'jpg' or extension == 'jpeg' or extension == 'png' or extension == 'gif'}">
									<img th:src="@{/attach/{fileName}(fileName=${attach.attachName})}" alt="첨부 이미지"/>
								</div>

								<!-- 기타 파일인 경우 -->
								<div th:unless="${extension == 'jpg' or extension == 'jpeg' or extension == 'png' or extension == 'gif'}">
									<a th:href="@{/attach/{fileName}(fileName=${attach.attachName})}"
									   th:text="${attach.attachName}" download>
										<button>📥 파일 다운로드</button>
									</a>
								</div>
							</div>
						</div>
					</div>
				</div>

				<!-- 피드백 -->
				<div class="feed-container">
					<h3 id="diaryEmotion" th:text="${diary.diaryEmotion != null ? diary.diaryEmotion : '⏳ 피드백을 생성 중입니다...'}"></h3>
					<p id="diaryFeedback" th:text="${diary.diaryEmotion}?:'잠시만 기다려 주세요...'"></p>
				</div>
			</div>

			<!-- 버튼 -->
			<div class="update-delete-container">
				<button class="update-btn" th:onclick="|location.href='@{/diary/update(diaryId=${diary.diaryId})}'|">수정</button>
				<button class="delete-btn" th:onclick="|if(confirm('정말로 삭제하시겠습니까?')) { location.href='@{/diary/delete(diaryId=${diary.diaryId})}'; }|">삭제</button>
			</div>
		</div>
	</div>
</div>

<th:block layout:fragment="script">
	<!-- FullCalendar JS -->
	<script src="https://cdn.jsdelivr.net/npm/@fullcalendar/core@6.1.8/index.global.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/@fullcalendar/daygrid@6.1.8/index.global.min.js"></script>

	<!-- Custom JS -->
	<script>
		document.addEventListener('DOMContentLoaded', function() {
			const calendarEl = document.getElementById('calendar');

			// FullCalendar 초기화
			const calendar = new FullCalendar.Calendar(calendarEl, {
				initialView: 'dayGridMonth',
				locale: 'en', // 영어 설정
				headerToolbar: false, // 기본 헤더 툴바 제거
				dayHeaderContent: (args) => args.text.substr(0, 3), // 요일 이름을 앞 세 글자로 표시
				events: [], // 이벤트 없음
				aspectRatio: 1.35, // 기존보다 넓어지게 조정
				contentHeight: 'auto' // 자동 높이 조정
			});

			calendar.render();

			// 드롭다운 초기화
			const yearSelect = document.getElementById('year-select');
			const monthSelect = document.getElementById('month-select');

			const currentYear = new Date().getFullYear();

			// 년도 드롭다운 채우기 (현재 년도 기준 ±5년)
			for (let i = currentYear - 5; i <= currentYear + 5; i++) {
				const option = document.createElement('option');
				option.value = i;
				option.textContent = `${i} 년`;
				if (i === currentYear) option.selected = true; // 현재 년도 선택
				yearSelect.appendChild(option);
			}

			// 월 드롭다운 초기값 설정
			monthSelect.value = new Date().getMonth();

			// 드롭다운 변경 이벤트 핸들러
			function updateCalendar() {
				const selectedYear = parseInt(yearSelect.value);
				const selectedMonth = parseInt(monthSelect.value);

				// 선택된 년도와 월로 이동
				calendar.gotoDate(new Date(selectedYear, selectedMonth));
			}

			yearSelect.addEventListener('change', updateCalendar);
			monthSelect.addEventListener('change', updateCalendar);

			const diaryEmotion = document.getElementById("diaryEmotion");
			const diaryFeedback = document.getElementById("diaryFeedback");
			const feedContainer = document.querySelector(".feed-container");

			switch (diaryEmotion.textContent) {
				case "기쁨":
					// message = "오늘 정말 좋은 하루였군요! 이 행복한 순간이 오래도록 기억에 남길 바라요. 💛"
					message = "오늘 정말 좋은 일이 있었군요! 이런 순간들은 삶을 더 빛나게 만들어 주죠. 기쁨을 충분히 만끽하고, 나중에 돌아봤을 때도 웃을 수 있도록 소중한 기억으로 남겨보세요. 이 행복한 기운이 오래도록 이어지길 바라요! 💛";
					feedContainer.style.backgroundColor = "#edd2d2";
					break;
				case "슬픔":
					// message = "힘든 순간이지만, 이 또한 지나갈 거예요. 당신의 마음이 조금이라도 편해지길 바라요. 💙"
					message = "마음이 많이 힘들었겠어요. 하지만 어떤 감정이든 우리에게 필요한 순간이 있어요. 충분히 슬퍼하고, 스스로를 위로해 주세요. 혼자가 아니라는 걸 잊지 마세요. 당신의 마음이 점점 따뜻해지고, 힘든 순간을 잘 지나갈 수 있길 진심으로 응원할게요. 💙";
					feedContainer.style.backgroundColor = "#edd2d2";
					break;
				case "분노":
					// message = "속상하고 억울한 일이 있었나 보네요. 감정을 솔직하게 표현하는 건 중요해요. 조금만 마음을 가라앉히고 스스로를 다독여 보세요. 💜";
					message = "정말 속상하고 화가 났겠어요. 때로는 감정을 드러내는 것도 필요한 법이죠. 하지만 그 감정에 휩쓸리기보다는, 차분하게 정리해 보면 나를 더 지키는 방법을 찾을 수도 있을 거예요. 당신의 감정은 소중하고 정당한 것이니, 천천히 다독이며 좋은 방향으로 풀어나가길 바라요.";
					feedContainer.style.backgroundColor = "#edd2d2";
					break;
				case "불안":
					// message = 불안한 마음이 들 때는 깊게 숨을 쉬고, 지금 할 수 있는 것에 집중해 보세요. 당신은 충분히 잘해내고 있어요! 💚";
					message = "불안한 마음이 들 때는 정말 아무것도 손에 잡히지 않을 때가 많죠. 하지만 지금 이 순간에도 당신은 잘 해내고 있어요. 작은 것부터 하나씩 해결해 나가다 보면 어느새 불안함도 조금씩 옅어질 거예요. 무엇보다 스스로를 너무 몰아붙이지 말고, 충분히 쉬어가며 나아가길 바라요. 당신은 분명 좋은 방향으로 가고 있어요! 💚";
					feedContainer.style.backgroundColor = "#edd2d2";
					break;
				case "당황":
					// message = "예상치 못한 일이 있었군요! 하지만 이런 경험이 우리를 더 유연하고 지혜롭게 만들어 준답니다. 괜찮아요! 💛";
					message = "예상치 못한 일이 생기면 순간적으로 어떻게 해야 할지 막막할 때가 있죠. 하지만 이런 경험들이 쌓이면 점점 더 유연하고 지혜로운 사람이 되어갈 거예요. 처음엔 당황스럽겠지만, 지금의 경험이 나중에는 하나의 이야기로 남을 수도 있어요. 너무 자책하지 말고, 오늘도 충분히 잘해냈다는 걸 기억하세요! 💛";
					feedContainer.style.backgroundColor = "#edd2d2";
					break;
				case "상처":
					// message = "마음이 아픈 일이 있었나 봐요. 하지만 당신의 가치는 변하지 않아요. 충분히 소중한 사람이니까요. 💖";
					message = "마음이 많이 아팠겠어요. 때때로 우리는 다른 사람의 말이나 행동에 상처를 받기도 하지만, 그 누구도 당신의 가치를 결정할 수 없어요. 당신은 소중하고, 그 자체로 충분히 빛나는 사람이에요. 상처받은 마음이 천천히 회복될 수 있도록 스스로를 아껴 주세요. 그리고 꼭 기억하세요, 당신은 사랑받을 자격이 있는 존재랍니다. 💖";
					feedContainer.style.backgroundColor = "#edd2d2";
					break;
				default:
					// message = "평온한 하루를 보냈군요. 이런 일상이 쌓이면 마음도 한결 편안해질 거예요. 오늘도 수고 많았어요! 🤍";
					message = "무난한 하루를 보내셨나요? 때로는 이런 평범한 날들이 가장 소중한 순간이 되기도 해요. 조용한 하루 속에서도 작은 행복을 찾아보는 건 어떨까요? 좋아하는 음악을 듣거나, 따뜻한 차 한 잔을 마시면서 스스로에게 작은 휴식을 선물해 보세요. 오늘도 수고 많았어요! 🤍";
					feedContainer.style.backgroundColor = "#ebebeb";
					break;
			}
			diaryFeedback.textContent = message;
		});
	</script>
	<!--
	<script>
		document.addEventListener("DOMContentLoaded", function() {
			const diaryFeedback = document.getElementById("diaryFeedback");

			// 만약 백엔드에서 데이터를 아직 제공하지 않았다면, 로딩 알럿 표시
			if (diaryFeedback.textContent.includes("피드백을 생성 중입니다")) {
				alert("피드백을 생성하고 있습니다. 잠시만 기다려 주세요...");
			}
		});
	</script>
	-->
</th:block>
</body>
</html>