<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="app.labs.admin.dao.AdminRepository">
    <!-- 특정 회원 ID로 회원 정보 조회 쿼리 -->
    <select id="getMemberList" parameterType="java.util.Map" resultType="app.labs.register.model.Member">
        SELECT * FROM MEMBER
        <where>
            <if test="memberId != null and memberId != ''">
                MEMBER_ID LIKE '%' || #{memberId} || '%'
            </if>
            <if test="memberName != null and memberName != ''">
                AND MEMBER_NAME LIKE '%' || #{memberName} || '%'
            </if>
        </where>
    </select>

    <!-- 회원 상태 수정 -->
    <update id="updateMemberStatus">
        UPDATE MEMBER
        SET MEMBER_STATUS = #{memberStatus}
        WHERE MEMBER_ID = #{memberId}
    </update>

    <!-- 회원 통계 관련 -->
    <select id="getMemberStatsByYear" resultType="map">
        SELECT EXTRACT(YEAR FROM member_signup_date) as year, 
               COUNT(*) as count
        FROM member
        GROUP BY EXTRACT(YEAR FROM member_signup_date)
        ORDER BY year
    </select>

    <select id="getMemberStatsByMonth" resultType="map">
        SELECT TO_CHAR(SYSDATE, 'YYYY') as year,
               TO_CHAR(member_signup_date, 'YYYY-MM') as month, 
               COUNT(*) as count
        FROM member
        WHERE EXTRACT(YEAR FROM member_signup_date) = EXTRACT(YEAR FROM SYSDATE)
        GROUP BY TO_CHAR(SYSDATE, 'YYYY'), TO_CHAR(member_signup_date, 'YYYY-MM')
        ORDER BY month
    </select>

    <select id="getMemberStatsByDay" resultType="map">
        SELECT TO_CHAR(SYSDATE, 'YYYY-MM') as month,
               TO_CHAR(member_signup_date, 'YYYY-MM-DD') as day, 
               COUNT(*) as count
        FROM member
        WHERE TO_CHAR(member_signup_date, 'YYYY-MM') = TO_CHAR(SYSDATE, 'YYYY-MM')
        GROUP BY TO_CHAR(SYSDATE, 'YYYY-MM'), TO_CHAR(member_signup_date, 'YYYY-MM-DD')
        ORDER BY day
    </select>
</mapper>
